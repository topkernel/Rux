# Rux

<div align="center">

**A Linux-like OS kernel entirely written in Rust**

[![Rust](https://img.shields.io/badge/Rust-stable-orange.svg)](https://www.rust-lang.org/)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/platform-aarch64--x86__64--riscv64-informational.svg)](https://github.com/rust-osdev/rust-embedded)

Rux æ˜¯ä¸€ä¸ªå®Œå…¨ç”¨ **Rust** ç¼–å†™çš„ç±» Linux æ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆé™¤å¿…è¦çš„å¹³å°ç›¸å…³æ±‡ç¼–ä»£ç å¤–ï¼‰ã€‚

</div>

---

## ğŸ¤– AI ç”Ÿæˆå£°æ˜

**æœ¬é¡¹ç›®ä»£ç ç”± AIï¼ˆClaude Sonnet 4.5ï¼‰è¾…åŠ©ç”Ÿæˆå’Œå¼€å‘ã€‚**

å¼€å‘è¿‡ç¨‹ï¼š
- ä½¿ç”¨ Anthropic çš„ Claude Code CLI å·¥å…·è¿›è¡Œè¾…åŠ©å¼€å‘
- AI ååŠ©ç¼–å†™ä»£ç ã€è°ƒè¯•é”™è¯¯ã€ä¼˜åŒ–ç»“æ„ã€ç¼–å†™æ–‡æ¡£
- æ‰€æœ‰ä»£ç éµå¾ª Linux å†…æ ¸çš„è®¾è®¡åŸåˆ™å’Œ POSIX æ ‡å‡†
- å¼€å‘è€…è´Ÿè´£å®¡æŸ¥æ‰€æœ‰ AI ç”Ÿæˆçš„ä»£ç å¹¶è¿›è¡Œæµ‹è¯•éªŒè¯

æœ¬é¡¹ç›®æ—¨åœ¨æ¢ç´¢ **AI è¾…åŠ©æ“ä½œç³»ç»Ÿå†…æ ¸å¼€å‘** çš„å¯èƒ½æ€§å’Œé™åˆ¶ã€‚

---

## ğŸ¯ é¡¹ç›®ç›®æ ‡

### âš ï¸ æœ€é«˜åŸåˆ™ï¼šPOSIX/ABI å®Œå…¨å…¼å®¹ï¼Œç»ä¸åˆ›æ–°

Rux çš„æ ¸å¿ƒç›®æ ‡æ˜¯**ç”¨ Rust é‡å†™ Linux å†…æ ¸**ï¼Œå®ç°ï¼š

- **100% POSIX å…¼å®¹**ï¼šå®Œå…¨éµå®ˆ POSIX æ ‡å‡†
- **Linux ABI å…¼å®¹**ï¼šå¯è¿è¡ŒåŸç”Ÿ Linux ç”¨æˆ·ç©ºé—´ç¨‹åº
- **ç³»ç»Ÿè°ƒç”¨å…¼å®¹**ï¼šä½¿ç”¨ Linux çš„ç³»ç»Ÿè°ƒç”¨å·å’Œæ¥å£
- **æ–‡ä»¶ç³»ç»Ÿå…¼å®¹**ï¼šæ”¯æŒ ext4ã€btrfs ç­‰ Linux æ–‡ä»¶ç³»ç»Ÿ
- **ELF æ ¼å¼å…¼å®¹**ï¼šå¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ä¸ Linux å®Œå…¨ä¸€è‡´

**ä¸¥æ ¼ç¦æ­¢**ï¼š
- âŒ ç»ä¸"ä¼˜åŒ–"æˆ–"æ”¹è¿›" Linux çš„è®¾è®¡
- âŒ ç»ä¸åˆ›é€ æ–°çš„ç³»ç»Ÿè°ƒç”¨æˆ–æ¥å£
- âŒ ç»ä¸ä¸ºäº†"æ›´ä¼˜é›…"è€Œåç¦»æ ‡å‡†

### å®ç°æ–¹å¼

é™¤å¹³å°ç›¸å…³çš„å¿…è¦æ±‡ç¼–ä»£ç å¤–ï¼Œæ‰€æœ‰ä»£ç ä½¿ç”¨ Rust ç¼–å†™ï¼Œä½†**æ‰€æœ‰è®¾è®¡å’Œæ¥å£å¿…é¡»å®Œå…¨éµå¾ª Linux æ ‡å‡†**ã€‚

- **å‚è€ƒå®ç°**ï¼šLinux å†…æ ¸æºç 
- **æ¥å£æ ‡å‡†**ï¼šPOSIX æ ‡å‡†ã€Linux ABI
- **æ–‡æ¡£å‚è€ƒ**ï¼šLinux man pagesã€å†…æ ¸æ–‡æ¡£

---

## å…¶ä»–ç›®æ ‡

- **å¤šå¹³å°**ï¼šæ”¯æŒ aarch64ã€x86_64ã€riscv64 æ¶æ„
- **æ¨¡å—åŒ–**ï¼šæ¸…æ™°çš„æ¨¡å—è¾¹ç•Œï¼Œä¾¿äºå¼€å‘å’Œæµ‹è¯•
- **å¯æµ‹è¯•æ€§**ï¼šå®Œå–„çš„æµ‹è¯•å¥—ä»¶

---

## âœ¨ å½“å‰çŠ¶æ€

### âœ… Phase 1 å®Œæˆï¼ˆ2025-02-02ï¼‰

åŸºç¡€æ¡†æ¶å·²å°±ç»ªï¼Œå†…æ ¸å¯ä»¥åœ¨ QEMU (riscv64ã€aarch64) ä¸ŠæˆåŠŸå¯åŠ¨ï¼š

**å·²å®ç°åŠŸèƒ½**ï¼š
- âœ… aarch64 å¹³å°å¯åŠ¨ä»£ç 
- âœ… UART é©±åŠ¨ (PL011)
- âœ… åŸºç¡€å†…å­˜ç®¡ç†ï¼ˆé¡µå¸§ã€å †åˆ†é…å™¨ï¼‰
- âœ… æ„å»ºå’Œæµ‹è¯•è„šæœ¬

### âœ… Phase 2 å®Œæˆï¼ˆ2025-02-03ï¼‰

**è¿›ç¨‹ç®¡ç†**ï¼š
- âœ… è¿›ç¨‹è°ƒåº¦å™¨æ¡†æ¶
- âœ… ä»»åŠ¡æ§åˆ¶å— (TCB)
- âœ… ä¸Šä¸‹æ–‡åˆ‡æ¢
- âœ… Fork ç³»ç»Ÿè°ƒç”¨

### âœ… Phase 3 å®Œæˆï¼ˆ2025-02-03ï¼‰

**ç³»ç»Ÿè°ƒç”¨ä¸éš”ç¦»** - æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼š
- âœ… ç”¨æˆ·/å†…æ ¸åœ°å€ç©ºé—´éš”ç¦»
- âœ… ç”¨æˆ·ç©ºé—´æ•°æ®å¤åˆ¶ï¼ˆcopy_from_user/copy_to_userï¼‰
- âœ… 28+ ç³»ç»Ÿè°ƒç”¨å®ç°
- âœ… ä¿¡å·å¤„ç†æ¡†æ¶ï¼ˆsigaction/kill/rt_sigreturn/rt_sigprocmaskï¼‰
- âœ… ä¿¡å·å¤„ç†å‡½æ•°è°ƒç”¨æœºåˆ¶ï¼ˆsetup_frame åŸºç¡€å®ç°ï¼‰

**è‡ªå®šä¹‰é›†åˆç±»å‹** ğŸ†• - ç»•è¿‡ alloc crate çš„ç¬¦å·å¯è§æ€§é—®é¢˜ï¼š
- âœ… SimpleBox - å †åˆ†é…çš„å€¼åŒ…è£…å™¨
- âœ… SimpleVec - åŠ¨æ€æ•°ç»„
- âœ… SimpleString - å­—ç¬¦ä¸²åŒ…è£…å™¨
- âœ… SimpleArc - åŸå­å¼•ç”¨è®¡æ•°æŒ‡é’ˆ

**æŠ€æœ¯çªç ´**ï¼š
æˆåŠŸè§£å†³äº† Rust ç¼–è¯‘å™¨åœ¨ no_std ç¯å¢ƒä¸­çš„ç¬¦å·å¯è§æ€§é—®é¢˜ï¼ˆ`__rust_no_alloc_shim_is_unstable_v2`ï¼‰ï¼Œé€šè¿‡å®Œå…¨ç»•è¿‡ alloc crateï¼Œç›´æ¥ä½¿ç”¨ GlobalAlloc trait å®ç°è‡ªå®šä¹‰é›†åˆç±»å‹ã€‚

**å½“å‰å†…æ ¸è¾“å‡º**ï¼š
```
Rux Kernel v0.1.0 starting...
Target platform: aarch64
Initializing architecture...
arch: IRQ disabled (will enable after GIC init)
Initializing trap handling...
System call support initialized
Initializing heap...
Initializing scheduler...
Scheduler: initialization complete
Initializing VFS...
GIC: Minimal init complete
Booting secondary CPUs...
[CPU1 up]
SMP: 2 CPUs online
SMP init complete, enabling IRQ...
IRQ enabled
System ready
Current PID: 0x0
Fork success: child PID = 0x2
Entering main loop
```

**å·²å®ç°ç³»ç»Ÿè°ƒç”¨ (43+)**ï¼š
**è¿›ç¨‹ç®¡ç†**ï¼š
- âœ… fork/vfork (57/58) - è¿›ç¨‹åˆ›å»º
- âœ… execve (59) - æ‰§è¡Œç¨‹åº
- âœ… exit (60) - è¿›ç¨‹é€€å‡º
- âœ… wait4 (61) - ç­‰å¾…å­è¿›ç¨‹
- âœ… kill (62) - å‘é€ä¿¡å·
- âœ… getpid/getppid (39/110) - è·å–è¿›ç¨‹ ID

**æ–‡ä»¶æ“ä½œ**ï¼š
- âœ… read/write (0/1) - æ–‡ä»¶è¯»å†™
- âœ… readv/writev (19/20) - å‘é‡ I/O
- âœ… openat (2/245) - æ‰“å¼€æ–‡ä»¶
- âœ… close (3) - å…³é—­æ–‡ä»¶
- âœ… lseek (8) - æ–‡ä»¶å®šä½
- âœ… pipe (22) - åˆ›å»ºç®¡é“
- âœ… dup/dup2 (32/33) - å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦
- âœ… fcntl (72) - æ–‡ä»¶æ§åˆ¶æ“ä½œ
- âœ… fsync/fdatasync (74/75) - æ–‡ä»¶åŒæ­¥
- âœ… pselect6 (258) - I/O å¤šè·¯å¤ç”¨ï¼ˆå¸¦ä¿¡å·æ©ç ï¼‰
- âœ… ppoll (259) - I/O å¤šè·¯å¤ç”¨ï¼ˆå¸¦ä¿¡å·æ©ç ï¼‰

**ç›®å½•æ“ä½œ**ï¼š
- âœ… mkdir (83) - åˆ›å»ºç›®å½•
- âœ… rmdir (84) - åˆ é™¤ç›®å½•
- âœ… unlink (82) - åˆ é™¤æ–‡ä»¶é“¾æ¥
- âœ… getdents64 (61) - è¯»å–ç›®å½•é¡¹

**å†…å­˜ç®¡ç†**ï¼š
- âœ… brk (12) - æ”¹å˜æ•°æ®æ®µå¤§å°
- âœ… mmap (9) - åˆ›å»ºå†…å­˜æ˜ å°„
- âœ… munmap (11) - å–æ¶ˆå†…å­˜æ˜ å°„
- âœ… mprotect (10) - æ”¹å˜å†…å­˜ä¿æŠ¤å±æ€§
- âœ… mincore (27) - æŸ¥è¯¢é¡µé¢é©»ç•™çŠ¶æ€
- âœ… madvise (28) - å†…å­˜ä½¿ç”¨å»ºè®®

**ä¿¡å·å¤„ç†**ï¼š
- âœ… sigaction (48) - è®¾ç½®ä¿¡å·å¤„ç†
- âœ… rt_sigreturn (15) - ä»ä¿¡å·å¤„ç†è¿”å›
- âœ… rt_sigprocmask (14) - ä¿¡å·æ©ç æ“ä½œï¼ˆå®Œæ•´å®ç°ï¼‰
- âœ… sigaltstack (131) - ä¿¡å·æ ˆæ”¯æŒ
- âœ… kill (62) - å‘é€ä¿¡å·
- âœ… ä¿¡å·å¸§ç»“æ„ä½“ (SignalFrame, UContext)
- âœ… ä¿¡å·å¤„ç†å‡½æ•°è°ƒç”¨æœºåˆ¶ (setup_frame, restore_sigcontext)

**ç³»ç»Ÿä¿¡æ¯**ï¼š
- âœ… uname (63) - è·å–ç³»ç»Ÿä¿¡æ¯
- âœ… gettimeofday (96) - è·å–ç³»ç»Ÿæ—¶é—´
- âœ… clock_gettime (217) - è·å–é«˜ç²¾åº¦æ—¶é’Ÿ
- âœ… ioctl (16) - è®¾å¤‡æ§åˆ¶
- âœ… getuid/getgid (102/104) - è·å–ç”¨æˆ·/ç»„ ID
- âœ… geteuid/getegid (107/108) - è·å–æœ‰æ•ˆç”¨æˆ·/ç»„ ID

**èµ„æºç®¡ç†**ï¼š
- âœ… getrlimit/setrlimit (97/160) - èµ„æºé™åˆ¶

### âœ… Phase 4 å®Œæˆï¼ˆ2025-02-03ï¼‰

**æ–‡ä»¶ç³»ç»Ÿ** - VFS æ¡†æ¶åŸºç¡€å®ç°å®Œæˆï¼š
- âœ… VFS åˆå§‹åŒ– (ä½¿ç”¨ SimpleArc)
- âœ… æ–‡ä»¶æ“ä½œæ¥å£ (file_open, file_close, file_read, file_write)
- âœ… æ–‡ä»¶æ§åˆ¶æ¥å£ (file_fcntl)
- âœ… I/O å¤šè·¯å¤ç”¨æ¥å£ (io_poll)
- âœ… æ–‡ä»¶æè¿°ç¬¦è¡¨ç®¡ç† (FdTable, alloc_fd, close_fd, dup_fd)
- âœ… è·¯å¾„è§£ææ¨¡å— (Path, PathComponent, PathComponents)
- âœ… è¶…çº§å—ç®¡ç† (SuperBlock, SuperBlockFlags)
- âœ… æ–‡ä»¶ç³»ç»Ÿæ³¨å†Œ (FileSystemType, FsRegistry)
- âœ… æŒ‚è½½/å¸è½½æ“ä½œ (do_mount, do_umount, mount_fs, kill_super)
- âœ… æŒ‚è½½ç‚¹ç®¡ç† (VfsMount, MntNamespace, MountTreeIter)
- âœ… **RootFS å†…å­˜æ–‡ä»¶ç³»ç»Ÿ** (RootFSNode, RootFSSuperBlock) - å®Œæ•´å®ç°
- âœ… **æ ¹æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°å‘½åç©ºé—´** - å·²å®Œæˆ
- âœ… SimpleString è·¯å¾„æ“ä½œæ–¹æ³•æ‰©å±•
- âœ… **å…¨å±€çŠ¶æ€åŒæ­¥ä¿æŠ¤** - ä½¿ç”¨ AtomicPtr ä¿æŠ¤å…¨å±€å˜é‡
- âœ… **SimpleArc ç»Ÿä¸€** - VFS å±‚ç»Ÿä¸€ä½¿ç”¨ SimpleArc
- âœ… **FdTable å®‰å…¨åˆå§‹åŒ–** - ä¿®å¤ MaybeUninit UB é—®é¢˜
- âœ… ä¼˜åŒ–ï¼šç§»é™¤è°ƒè¯•ä»£ç ï¼Œæ¸…ç†é“¾æ¥å™¨è„šæœ¬

**RootFS ç‰¹æ€§**ï¼š
- åŸºäº RAM çš„æ–‡ä»¶å­˜å‚¨
- æ”¯æŒç›®å½•å’Œå¸¸è§„æ–‡ä»¶
- æ–‡ä»¶åˆ›å»ºã€æŸ¥æ‰¾ã€è¯»å–ã€å†™å…¥
- ç›®å½•åˆ—è¡¨æ“ä½œ
- è‡ªåŠ¨ inode ID åˆ†é…
- æ ¹æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°å‘½åç©ºé—´
- **çº¿ç¨‹å®‰å…¨** - AtomicPtr ä¿æŠ¤å…¨å±€çŠ¶æ€

### âœ… Phase 5 å®Œæˆï¼ˆ2025-02-04ï¼‰

**SMP (å¯¹ç§°å¤šå¤„ç†) æ”¯æŒ** - åŒæ ¸å¯åŠ¨æˆåŠŸï¼š
- âœ… æ¬¡æ ¸å¯åŠ¨å…¥å£ç‚¹ (boot.S secondary_entry)
- âœ… PSCI CPU å”¤é†’ (HVC è°ƒç”¨)
- âœ… Per-CPU æ ˆç®¡ç† (æ¯ä¸ª CPU 16KB æ ˆ)
- âœ… SMP æ•°æ®ç»“æ„ (SmpData, CpuBootInfo)
- âœ… CPU æ•°é‡æ£€æµ‹ (get_active_cpu_count)
- âœ… æµ‹è¯•è„šæœ¬ (test_smp.sh)
- âœ… **GICv3 ä¸­æ–­æ§åˆ¶å™¨** - å®Œå…¨åˆå§‹åŒ–ï¼ˆGICD/GICRï¼‰
- âœ… **IPI (æ ¸é—´ä¸­æ–­)** - åŸºäº SGI çš„ IPI æœºåˆ¶
- âœ… **MMU å¤šçº§é¡µè¡¨** - å·²å¯ç”¨å¹¶æ­£å¸¸å·¥ä½œ
- âœ… **ä¸­æ–­é£æš´ä¿®å¤** - IRQ æ—¶åºæ§åˆ¶ä¼˜åŒ–

**æµ‹è¯•éªŒè¯**ï¼š
```
[SMP: Calling PSCI for CPU 1]
[SMP: PSCI result = 0000000000000000]
[CPU1 up]
SMP: 2 CPUs online
```

**æŠ€æœ¯è¦ç‚¹**ï¼š
- ä½¿ç”¨ PSCI (Power State Coordination Interface) å”¤é†’æ¬¡æ ¸
- HVC (Hypervisor Call) è€Œé SMC (Secure Monitor Call) ç”¨äº QEMU virt
- Per-CPU æ ˆç©ºé—´é€šè¿‡é“¾æ¥å™¨è„šæœ¬åˆ†é…
- æ¬¡æ ¸é€šè¿‡ PSCI_CPU_ON (0xC4000003) å¯åŠ¨
- GICv3 ä½¿ç”¨å†…è”æ±‡ç¼–è®¿é—® GICD/GICRï¼ˆä¿®å¤ read_volatile æŒ‚èµ·é—®é¢˜ï¼‰
- IPI ä½¿ç”¨ ICC_SGI1R_EL1 å‘é€ Software Generated Interrupts
- MMU ä½¿ç”¨ 3 çº§é¡µè¡¨ï¼ˆ4KB é¡µé¢ï¼‰
- Spurious interrupt å¤„ç†ï¼ˆIRQ ID 1023ï¼‰
- IRQ åœ¨ SMP åˆå§‹åŒ–å®Œæˆåå¯ç”¨ï¼ˆé¿å…ä¸­æ–­é£æš´ï¼‰

### âœ… Phase 6 å®Œæˆï¼ˆ2025-02-04ï¼‰

**ä»£ç å®¡æŸ¥ä¸ä¼˜åŒ–** - å…¨é¢å®Œæˆï¼š
- âœ… **å…¨é¢ä»£ç å®¡æŸ¥** - å‘ç°å¹¶è®°å½• 15 ä¸ªé—®é¢˜
- âœ… **è°ƒè¯•è¾“å‡ºæ¸…ç†** - ç§»é™¤ 50+ å¤„ putchar() å¾ªç¯
- âœ… **æ¡ä»¶ç¼–è¯‘ä¼˜åŒ–** - ä½¿ç”¨ #[cfg(debug_assertions)] æ§åˆ¶è°ƒè¯•è¾“å‡º
- âœ… **æµ‹è¯•è„šæœ¬å®Œå–„** - test_suite.sh, test_smp.sh, test_ipi.sh, test_qemu.sh
- âœ… **Makefile å¢å¼º** - æ·»åŠ  `make smp` å’Œ `make ipi` å¿«æ·å‘½ä»¤
- âœ… **CODE_REVIEW.md** - è¯¦ç»†è®°å½•æ‰€æœ‰å‘ç°çš„é—®é¢˜å’Œä¿®å¤è®¡åˆ’

**æ¸…ç†çš„æ–‡ä»¶**ï¼š
- [boot.rs](kernel/src/arch/aarch64/boot.rs) - 2 å¤„
- [gicv3.rs](kernel/src/drivers/intc/gicv3.rs) - 17 å¤„
- [ipi.rs](kernel/src/arch/aarch64/ipi.rs) - 8 å¤„
- [allocator.rs](kernel/src/mm/allocator.rs) - 1 å¤„
- [main.rs](kernel/src/main.rs) - 20+ å¤„

**å‘ç°çš„ä¸»è¦é—®é¢˜**ï¼ˆè¯¦è§ [CODE_REVIEW.md](docs/CODE_REVIEW.md)ï¼‰ï¼š
- ~~ğŸ”´ å†…å­˜åˆ†é…å™¨æ— æ³•é‡Šæ”¾å†…å­˜~~ âœ… å·²ä¿®å¤ - Buddy System å®ç°
- ~~ğŸ”´ å…¨å±€å•é˜Ÿåˆ—è°ƒåº¦å™¨é™åˆ¶å¤šæ ¸æ‰©å±•~~ âœ… å·²ä¿®å¤ - Per-CPU è¿è¡Œé˜Ÿåˆ—å®ç°
- ~~ğŸ”´ è¿‡å¤šçš„è°ƒè¯•è¾“å‡º~~ âœ… å·²ä¿®å¤ - å·²æ¸…ç† 50+ å¤„
- ~~ğŸŸ¡ SimpleArc Clone æ”¯æŒé—®é¢˜~~ âœ… å·²ä¿®å¤ - collection.rs å·²å®ç° Clone trait
- ~~ğŸŸ¡ VFS å‡½æ•°æŒ‡é’ˆå®‰å…¨æ€§é—®é¢˜~~ âœ… å·²ä¿®å¤ - ä½¿ç”¨å¼•ç”¨å’Œåˆ‡ç‰‡æ›¿ä»£è£¸æŒ‡é’ˆ

### âœ… Phase 7 å®Œæˆï¼ˆ2025-02-04ï¼‰

**å†…å­˜ç®¡ç†** - Buddy System åˆ†é…å™¨å®ç°ï¼š
- âœ… **Buddy System (ä¼™ä¼´ç³»ç»Ÿ)** å®Œæ•´å®ç°
  - O(log n) åˆ†é…/é‡Šæ”¾å¤æ‚åº¦
  - ä¼™ä¼´åˆå¹¶æœºåˆ¶å‡å°‘å†…å­˜ç¢ç‰‡
  - åŸºäº 4KB é¡µé¢çš„å—åˆ†é…
  - çº¿ç¨‹å®‰å…¨ï¼ˆåŸå­æ“ä½œï¼‰
  - æœ€å¤§æ”¯æŒ 4GB å†…å­˜å— (order 20)
- âœ… **BlockHeader æ•°æ®ç»“æ„** - å—å…ƒæ•°æ®ç®¡ç†
- âœ… **ç©ºé—²é“¾è¡¨ç®¡ç†** - æ¯ä¸ªè®¢å•çš„ç‹¬ç«‹é“¾è¡¨
- âœ… **å—åˆ†å‰²ç®—æ³•** - alloc_blocks å®ç°
- âœ… **ä¼™ä¼´åˆå¹¶ç®—æ³•** - free_blocks å®ç°
- âœ… **å †åœ°å€æ›´æ–°** - ä» 0x8800_0000 ç§»è‡³ 0x6000_0000
- âœ… **MMU é¡µè¡¨æ˜ å°„** - æ–°å¢å †åŒºåŸŸæ˜ å°„

**æµ‹è¯•éªŒè¯**ï¼š
```
Direct alloc works!
SimpleVec::push works!
SimpleVec::get works!
SimpleBox works!
SimpleString works!
SimpleArc works!
Fork success: child PID = 2
```

**æŠ€æœ¯çªç ´**ï¼š
è§£å†³äº† bump allocator æ— æ³•é‡Šæ”¾å†…å­˜çš„ä¸¥é‡é—®é¢˜ï¼Œå®ç°äº†çœŸæ­£çš„å†…å­˜åˆ†é…å™¨ã€‚é€šè¿‡ Buddy System ç®—æ³•ï¼Œå†…æ ¸ç°åœ¨å¯ä»¥æ­£ç¡®åœ°åˆ†é…ã€é‡Šæ”¾å’Œé‡ç”¨å†…å­˜ï¼Œæ”¯æŒé•¿æ—¶é—´è¿è¡Œã€‚

### âœ… Phase 8 å®Œæˆï¼ˆ2025-02-04ï¼‰

**Per-CPU ä¼˜åŒ–** - å¤šæ ¸è°ƒåº¦å®Œæˆï¼š
- âœ… **Per-CPU è¿è¡Œé˜Ÿåˆ—** - å¯¹åº” Linux runqueues
  - PER_CPU_RQ[4] - æ¯ä¸ª CPU ç‹¬ç«‹çš„è¿è¡Œé˜Ÿåˆ—
  - this_cpu_rq() - è·å–å½“å‰ CPU çš„è¿è¡Œé˜Ÿåˆ—
  - cpu_rq(cpu_id) - è·å–æŒ‡å®š CPU çš„è¿è¡Œé˜Ÿåˆ—
  - init_per_cpu_rq(cpu_id) - åˆå§‹åŒ– per-CPU é˜Ÿåˆ—
  - æ¬¡æ ¸è‡ªåŠ¨åˆå§‹åŒ–ï¼ˆåœ¨ secondary_cpu_start ä¸­è°ƒç”¨ï¼‰
  - schedule() ä½¿ç”¨ this_cpu_rq()
- âœ… **å¯åŠ¨é¡ºåºä¼˜åŒ–** - å‚è€ƒ Linux ARM64 å†…æ ¸
  - GIC åˆå§‹åŒ–æå‰åˆ° scheduler/VFS ä¹‹å‰
  - æ¬¡æ ¸å®Œå–„åˆå§‹åŒ–ï¼ˆrunqueueã€æ ˆã€IRQï¼‰
  - åˆ›å»º [BOOT_SEQUENCE.md](docs/BOOT_SEQUENCE.md) è¯¦ç»†æ–‡æ¡£
- âœ… **MMU å¤šçº§é¡µè¡¨** - 3 çº§é¡µè¡¨ï¼Œå·²å¯ç”¨å¹¶æ­£å¸¸å·¥ä½œ
- âœ… **ä¸­æ–­é£æš´ä¿®å¤** - IRQ æ—¶åºæ§åˆ¶ä¼˜åŒ–

**æµ‹è¯•éªŒè¯**ï¼š
```
sched: Initializing CPU 0 runqueue
sched: CPU 0 runqueue [OK]
[CPU1 up]
[CPU1] init: runqueue
sched: Initializing CPU 1 runqueue
sched: CPU 1 runqueue [OK]
[CPU1] init: IRQ enabled
[CPU1] idle: waiting for work
SMP: 2 CPUs online
```

**æŠ€æœ¯è¦ç‚¹**ï¼š
- å‚è€ƒ Linux å†…æ ¸çš„ per-CPU runqueue è®¾è®¡
- æ¯ä¸ªç‹¬ç«‹çš„è¿è¡Œé˜Ÿåˆ—å‡å°‘é”ç«äº‰
- æ¬¡æ ¸å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–è°ƒåº¦å™¨
- æ­£ç¡®çš„åˆå§‹åŒ–é¡ºåºï¼šMMU â†’ GIC â†’ SMP â†’ IRQ

### âœ… Phase 9 å®Œæˆï¼ˆ2025-02-04ï¼‰

**å¿«é€Ÿèƒœåˆ©** - æ–‡ä»¶ç³»ç»Ÿå…³é”®ä¿®å¤ï¼š
- âœ… **SimpleArc Clone æ”¯æŒ**
  - collection.rs å·²å®ç° Clone trait
  - RootFSNode::find_child() ä¿®å¤
  - RootFSNode::list_children() ä¿®å¤
- âœ… **RootFS write_data offset bug**
  - æ”¯æŒä» offset ä½ç½®å†™å…¥
  - æ­£ç¡®çš„æ–‡ä»¶å¤§å°è°ƒæ•´
  - ä½¿ç”¨ copy_from_slice è€Œéæ›¿æ¢
- âœ… **VFS å‡½æ•°æŒ‡é’ˆå®‰å…¨æ€§ä¼˜åŒ–**
  - FileOps å’Œ INodeOps æ”¹è¿›
  - ä½¿ç”¨å¼•ç”¨å’Œåˆ‡ç‰‡æ›¿ä»£è£¸æŒ‡é’ˆ
  - ç§»é™¤ä¸å¿…è¦çš„ unsafe fn
  - æ›´æ–°æ‰€æœ‰å®ç°ï¼ˆregã€pipeã€uartï¼‰
- âœ… **Dentry/Inode ç¼“å­˜æœºåˆ¶**
  - Dentry ç¼“å­˜ (dcache): 256-bucket å“ˆå¸Œè¡¨
  - Inode ç¼“å­˜ (icache): 256-bucket å“ˆå¸Œè¡¨
  - RootFS è·¯å¾„ç¼“å­˜: RootFS ä¸“ç”¨ç¼“å­˜
  - FNV-1a å“ˆå¸Œç®—æ³•
  - ç¼“å­˜ç»Ÿè®¡åŠŸèƒ½ï¼ˆå‘½ä¸­/æœªå‘½ä¸­è®¡æ•°ï¼‰
  - çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨ Mutex ä¿æŠ¤ï¼‰
- âœ… **è·¯å¾„è§„èŒƒåŒ–åŠŸèƒ½**
  - path_normalize() å‡½æ•°å®ç°
  - å¤„ç† `.` (å½“å‰ç›®å½•) å’Œ `..` (çˆ¶ç›®å½•)
  - ç§»é™¤å¤šä½™çš„ `/`
  - æ”¯æŒç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„
  - RootFS::lookup() é›†æˆ
  - å®Œæ•´å•å…ƒæµ‹è¯•è¦†ç›–
- âœ… **æ–‡ä»¶ç³»ç»Ÿæ“ä½œåŠŸèƒ½**
  - mkdir() - åˆ›å»ºç›®å½•
  - unlink() - åˆ é™¤æ–‡ä»¶
  - rmdir() - åˆ é™¤ç›®å½•
  - RootFSNode æ–¹æ³•å®Œå–„ï¼šadd_child, remove_child, rename_child
  - SimpleArc æ·»åŠ  as_ptr() æ–¹æ³•æ”¯æŒèŠ‚ç‚¹ä¿®æ”¹
- âœ… **ç¬¦å·é“¾æ¥æ”¯æŒ**
  - RootFSType æ·»åŠ  SymbolicLink ç±»å‹
  - symlink() - åˆ›å»ºç¬¦å·é“¾æ¥
  - readlink() - è¯»å–ç¬¦å·é“¾æ¥ç›®æ ‡
  - follow_link() - è·Ÿéšç¬¦å·é“¾æ¥
  - å¾ªç¯æ£€æµ‹ï¼ˆMAX_SYMLINKS = 40ï¼‰
  - lookup() è‡ªåŠ¨è·Ÿéšç¬¦å·é“¾æ¥

**æµ‹è¯•éªŒè¯**ï¼š
```
âœ“ ç¼–è¯‘é€šè¿‡
âœ“ SimpleArc Clone å¯ç”¨
âœ“ æ–‡ä»¶ç³»ç»Ÿæ“ä½œä¿®å¤å®Œæˆ
âœ“ VFS å‡½æ•°æŒ‡é’ˆå®‰å…¨æ€§æå‡
âœ“ ç¼“å­˜æœºåˆ¶æ­£å¸¸å·¥ä½œ
âœ“ è·¯å¾„è§„èŒƒåŒ–åŠŸèƒ½æ­£å¸¸
âœ“ æ–‡ä»¶ç³»ç»Ÿæ“ä½œåŠŸèƒ½æ­£å¸¸
âœ“ ç¬¦å·é“¾æ¥åŠŸèƒ½æ­£å¸¸
```

**æŠ€æœ¯çªç ´**ï¼š
1. ä¿®å¤äº†æ–‡ä»¶ç³»ç»Ÿçš„å…³é”®åŠŸèƒ½ï¼Œä½¿å¾—æ–‡ä»¶æŸ¥æ‰¾ã€åˆ—è¡¨å’Œå†™å…¥æ“ä½œèƒ½å¤Ÿæ­£å¸¸å·¥ä½œ
2. æå‡äº† VFS å±‚çš„ç±»å‹å®‰å…¨å’Œå†…å­˜å®‰å…¨ï¼Œä½¿ç”¨ Rust çš„ç±»å‹ç³»ç»Ÿä¿è¯å®‰å…¨æ€§
3. å®ç°äº†å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜æœºåˆ¶ï¼Œæ˜¾è‘—æå‡è·¯å¾„æŸ¥æ‰¾æ€§èƒ½
4. å®ç°äº†è·¯å¾„è§„èŒƒåŒ–ï¼Œæ”¯æŒ `.` å’Œ `..` ç‰¹æ®Šç›®å½•ï¼Œç¬¦åˆ POSIX æ ‡å‡†
5. å®ç°äº†å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆmkdir, unlink, rmdirï¼‰ï¼Œç¬¦åˆ Linux VFS æ¥å£
6. å®ç°äº†ç¬¦å·é“¾æ¥æ”¯æŒï¼ŒåŒ…æ‹¬åˆ›å»ºã€è¯»å–å’Œè‡ªåŠ¨è·Ÿéšï¼Œç¬¦åˆ POSIX æ ‡å‡†

**å¾…å®Œæˆ**ï¼ˆPhase 10ï¼‰ï¼š
- â³ è´Ÿè½½å‡è¡¡æœºåˆ¶ï¼ˆä»»åŠ¡è¿ç§»ï¼‰

### âœ… Phase 10 å®Œæˆï¼ˆ2025-02-06ï¼‰

**RISC-V 64ä½æ¶æ„ + Timer Interrupt + MMU** - æ ¸å¿ƒçªç ´ ğŸ¯

#### ä¸»è¦æˆå°±

**1. MMU å’Œé¡µè¡¨ç®¡ç†** - è™šæ‹Ÿå†…å­˜æ”¯æŒ ğŸ†•
- âœ… RISC-V Sv39 åˆ†é¡µæœºåˆ¶ï¼ˆ3çº§é¡µè¡¨ï¼‰
- âœ… satp CSR ç®¡ç†ï¼ˆSv39æ¨¡å¼ï¼‰
- âœ… é¡µè¡¨æ˜ å°„å®ç°ï¼ˆmap_page, map_regionï¼‰
- âœ… å†…æ ¸ç©ºé—´æ’ç­‰æ˜ å°„ï¼ˆ0x80200000+ï¼‰
- âœ… è®¾å¤‡å†…å­˜æ˜ å°„ï¼ˆUARTã€CLINTï¼‰
- âœ… **MMU å·²æˆåŠŸä½¿èƒ½å¹¶è¿è¡Œ**

**2. Timer Interrupt å®ç°** - æœ€é‡è¦çš„çªç ´
- âœ… **stvec Direct æ¨¡å¼ä¿®å¤** - Timer interrupt ä¸è§¦å‘çš„æ ¹æœ¬åŸå› 
  - é—®é¢˜ï¼šstvec = 0x8020002cï¼Œæœ€åä¸¤ä½æ˜¯ 0b11ï¼ˆVectored æ¨¡å¼ï¼‰
  - ä¿®å¤ï¼šæ¸…é™¤æœ€åä¸¤ä½ç¡®ä¿ Direct æ¨¡å¼ï¼ˆ0b00ï¼‰
  - Vectored æ¨¡å¼è·³è½¬åˆ° stvec + 4 * cause
  - Direct æ¨¡å¼ç›´æ¥è·³è½¬åˆ° stvec åœ°å€
- âœ… **SBI 0.2 TIMER extension**
  - ä½¿ç”¨ `sbi_rt::set_timer()` è®¾ç½®å®šæ—¶å™¨
  - å‘¨æœŸæ€§ä¸­æ–­ï¼ˆ1 ç§’é—´éš”ï¼‰
- âœ… **ä¸­æ–­ä½¿èƒ½**
  - sie.STIE (bit 5) - Timer ä¸­æ–­ä½¿èƒ½
  - sstatus.SIE (bit 1) - å…¨å±€ä¸­æ–­ä½¿èƒ½ï¼ˆä½¿ç”¨å†…è”æ±‡ç¼–ï¼‰

**2. RISC-V MMU å’Œé¡µè¡¨ç®¡ç†** - è™šæ‹Ÿå†…å­˜æ”¯æŒ ğŸ†•
- âœ… **RISC-V Sv39 åˆ†é¡µæœºåˆ¶**
  - 3çº§é¡µè¡¨ç»“æ„ï¼ˆ512 PTE/çº§ï¼‰
  - 39ä½è™šæ‹Ÿåœ°å€ï¼ˆ512GBåœ°å€ç©ºé—´ï¼‰
  - 4KB é¡µå¤§å°
  - é¡µè¡¨é¡¹æ ¼å¼ï¼šV/R/W/X/U/G/A/D æ ‡å¿—ä½
- âœ… **satp CSR ç®¡ç†**
  - Sv39 æ¨¡å¼ï¼ˆMODE=8ï¼‰
  - æ ¹é¡µè¡¨ç‰©ç†é¡µå·ï¼ˆPPNï¼‰ç®¡ç†
  - MMU ä½¿èƒ½/ç¦ç”¨æ§åˆ¶
  - TLB åˆ·æ–°ï¼ˆsfence.vmaï¼‰
- âœ… **é¡µè¡¨æ˜ å°„å®ç°**
  - `map_page()` - æ˜ å°„å•ä¸ª4KBé¡µ
  - `map_region()` - æ˜ å°„å†…å­˜åŒºåŸŸ
  - 3çº§é¡µè¡¨éå†ï¼ˆVPN2 â†’ VPN1 â†’ VPN0ï¼‰
  - åŠ¨æ€é¡µè¡¨åˆ†é…ï¼ˆé™æ€æ± ï¼‰
- âœ… **å†…å­˜æ˜ å°„**
  - å†…æ ¸ç©ºé—´æ’ç­‰æ˜ å°„ï¼ˆ0x80200000 - 0x80400000ï¼Œ2MBï¼‰
  - è®¾å¤‡å†…å­˜æ˜ å°„ï¼ˆUART @ 0x10000000ï¼‰
  - CLINT æ˜ å°„ï¼ˆ0x02000000ï¼‰
  - æƒé™æ§åˆ¶ï¼ˆR/W/X/A/Dï¼‰
- âœ… **é¡µé”™è¯¯å¤„ç†**
  - InstructionPageFault
  - LoadPageFault
  - StorePageFault
  - stval å¯„å­˜å™¨æ˜¾ç¤ºé”™è¯¯åœ°å€
- âœ… **MMU å·²æˆåŠŸä½¿èƒ½å¹¶è¿è¡Œ**
  - satp = 0x8000000000080208 (MODE=8, PPN=0x80208)
  - ç³»ç»Ÿåœ¨è™šæ‹Ÿåœ°å€æ¨¡å¼ä¸‹æ­£å¸¸è¿è¡Œ
  - Timer interrupt åœ¨ MMU ç¯å¢ƒä¸‹æ­£å¸¸å·¥ä½œ

**3. RISC-V 64ä½æ¶æ„å®Œæ•´æ”¯æŒ**
- âœ… **å¯åŠ¨æµç¨‹** - boot.rs + OpenSBI é›†æˆ
  - æ ˆè®¾ç½®ï¼š0x801F_C000ï¼ˆ16KBï¼‰
  - BSS æ¸…é™¤
  - trap å‘é‡åˆå§‹åŒ–
  - å†…å­˜å¸ƒå±€ï¼šå†…æ ¸ 0x80200000ï¼ˆé¿å¼€ OpenSBI åŒºåŸŸï¼‰
- âœ… **å¼‚å¸¸å¤„ç†** - S-mode trap handler
  - trap_entry æ±‡ç¼–å…¥å£ï¼ˆä¿å­˜/æ¢å¤å¯„å­˜å™¨ï¼‰
  - trap_handler Rust å‡½æ•°ï¼ˆå¼‚å¸¸åˆ†å‘ï¼‰
  - S-mode CSRï¼šsstatusã€sepcã€stvalã€scauseã€stvec
- âœ… **UART é©±åŠ¨** - ns16550a @ 0x10000000
- âœ… **æµ‹è¯•è„šæœ¬** - å®Œæ•´çš„æµ‹è¯•æ¡†æ¶
  - test/run_riscv.sh - RISC-V è¿è¡Œ
  - test/debug_riscv.sh - GDB è°ƒè¯•
  - test/all.sh - å…¨å¹³å°æµ‹è¯•å¥—ä»¶

**4. è°ƒè¯•è¾“å‡ºæ¸…ç†**
- âœ… ç§»é™¤ Timer interrupt è¯¦ç»†è¾“å‡º
- âœ… ç§»é™¤ trap_handler å…¥å£æç¤º
- âœ… ä¿ç•™å¿…è¦çš„åˆå§‹åŒ–ä¿¡æ¯
- âœ… è¾“å‡ºç®€æ´æ¸…æ™°

#### æµ‹è¯•éªŒè¯
```
Rux OS v0.1.0 - RISC-V 64-bit
trap: Initializing RISC-V trap handling...
trap: Exception vector table installed at stvec = 0x8020002c
trap: RISC-V trap handling [OK]
mm: Initializing RISC-V MMU (Sv39)...
mm: Current satp = 0x0 (MODE=0)
mm: Root page table at PPN = 0x80208
mm: Page table mappings created
mm: Enabling MMU (Sv39)...
mm: satp = 0x8000000000080208 (MODE=8, PPN=0x80208)
mm: MMU enabled successfully
mm: RISC-V MMU [OK]
[OK] Timer interrupt enabled, system ready.
```

Timer interrupt æ­£å¸¸å·¥ä½œï¼Œæ¯ç§’è§¦å‘ä¸€æ¬¡ï¼

#### æŠ€æœ¯ç»†èŠ‚

**stvec æ¨¡å¼å¯¹æ¯”**ï¼š
| æ¨¡å¼ | æœ€åä¸¤ä½ | è·³è½¬åœ°å€ | ç”¨é€” |
|------|----------|----------|------|
| Direct | 00 | stvec | ç»Ÿä¸€å…¥å£ï¼ˆRux ä½¿ç”¨ï¼‰ |
| Vectored | 01 | stvec + 4*cause | å‘é‡åŒ–è·³è½¬ |

**ä¸ºä»€ä¹ˆ Timer interrupt ä¸è§¦å‘**ï¼š
- stvec è¢«è®¾ç½®ä¸º 0x8020002cï¼ˆVectored æ¨¡å¼ï¼‰
- Timer interrupt çš„ cause = 5
- å®é™…è·³è½¬åœ°å€ï¼š0x8020002c + 4*5 = 0x80200040
- ä½† trap_entry åœ¨ 0x8020002c
- ä¿®å¤ï¼šstvec = trap_entry & !0x3 = 0x8020002c & ~0x3 = 0x8020002c

#### å‚è€ƒèµ„æ–™
- [RISC-V ç‰¹æƒæ¶æ„è§„èŒƒ](https://riscv.org/technical/specifications/)
- [SBI 0.2 è§„èŒƒ](https://github.com/riscv-non-isa/riscv-sbi-doc)
- [OpenSBI æ–‡æ¡£](https://github.com/riscv/opensbi)

**æµ‹è¯•éªŒè¯**ï¼š
```
OpenSBI v0.9
...
Domain0 Next Mode: S-mode
...
Rux OS v0.1.0 - RISC-V 64-bit
trap: Initializing RISC-V trap handling...
trap: Exception vector table installed at stvec = 0x8020002c
trap: RISC-V trap handling [OK]
[OK] Timer interrupt enabled, system ready.
```

**æŠ€æœ¯çªç ´**ï¼š
1. æˆåŠŸä» ARM aarch64 è¿ç§»åˆ° RISC-V 64ä½æ¶æ„
2. æ­£ç¡®å¤„ç† M-modeï¼ˆOpenSBIï¼‰å’Œ S-modeï¼ˆå†…æ ¸ï¼‰çš„æƒé™åˆ†ç¦»
3. ä¿®å¤äº†æ‰€æœ‰ CSR å¯„å­˜å™¨çš„è®¿é—®æ–¹å¼
4. å®ç°äº†å®Œæ•´çš„å¼‚å¸¸å¤„ç†å’Œç³»ç»Ÿè°ƒç”¨æœºåˆ¶
5. **RISC-V ç°åœ¨æ˜¯é»˜è®¤æ„å»ºç›®æ ‡**

**æ„å»ºå’Œè¿è¡Œ**ï¼š
```bash
# æ„å»ºé»˜è®¤å¹³å°ï¼ˆRISC-Vï¼‰
cargo build --package rux --features riscv64

# è¿è¡Œ RISC-V å†…æ ¸
./test/run_riscv64.sh

# è¿è¡Œ ARM å†…æ ¸ï¼ˆéœ€è¦æ˜¾å¼æŒ‡å®šï¼‰
cargo build --package rux --features aarch64
./test/run.sh
```

**æ¶æ„åˆ‡æ¢**ï¼š
- é»˜è®¤å¹³å°ï¼š`riscv64`ï¼ˆåœ¨ kernel/Cargo.toml ä¸­è®¾ç½®ï¼‰
- ç›®æ ‡ä¸‰å…ƒç»„ï¼š`riscv64gc-unknown-none-elf`
- é…ç½®æ–‡ä»¶ï¼š`.cargo/config.toml`

---

## ğŸ“š æ–‡æ¡£

- **[è®¾è®¡åŸåˆ™](docs/DESIGN.md)** - é¡¹ç›®çš„è®¾è®¡ç†å¿µå’ŒæŠ€æœ¯çº¦æŸ
- **[å¼€å‘è·¯çº¿å›¾](docs/TODO.md)** - è¯¦ç»†çš„ä»»åŠ¡åˆ—è¡¨å’Œè¿›åº¦è¿½è¸ª
- **[ä»£ç å®¡æŸ¥è®°å½•](docs/CODE_REVIEW.md)** - ä»£ç å®¡æŸ¥å‘ç°çš„é—®é¢˜å’Œä¿®å¤è¿›åº¦
- **[RISC-V æ¶æ„å®ç°](docs/RISCV64.md)** - RISC-V 64ä½æ¶æ„è¯¦ç»†æ–‡æ¡£ ğŸ†•
- **[å¯åŠ¨é¡ºåºåˆ†æ](docs/BOOT_SEQUENCE.md)** - å†…æ ¸å¯åŠ¨é¡ºåºä¸ Linux å¯¹æ¯”åˆ†æ
- **[è‡ªå®šä¹‰é›†åˆç±»å‹](docs/COLLECTIONS.md)** - SimpleBox/SimpleVec/SimpleArc çš„è®¾è®¡ä¸å®ç°
- **[API æ–‡æ¡£](https://docs.rs/)** - Rust ä»£ç æ–‡æ¡£ï¼ˆå¾…ç”Ÿæˆï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Rust å·¥å…·é“¾ï¼ˆstableï¼‰
- QEMU ç³»ç»Ÿæ¨¡æ‹Ÿå™¨
- riscv64 å·¥å…·é“¾ï¼ˆé»˜è®¤ï¼Œå·²åŒ…å«åœ¨ Rust ä¸­ï¼‰
- aarch64 å·¥å…·é“¾ï¼ˆå¯é€‰ï¼Œç”¨äº ARM å¹³å°ï¼‰

### æ„å»ºå’Œè¿è¡Œ

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-username/rux.git
cd rux

# æ„å»ºå†…æ ¸ï¼ˆé»˜è®¤ RISC-V å¹³å°ï¼‰
cargo build --package rux --features riscv64

# è¿è¡Œ RISC-V å†…æ ¸ï¼ˆé»˜è®¤ï¼‰
./test/run_riscv64.sh

# æˆ–è€…ä½¿ç”¨ make
make build
make run

# æ„å»º ARM å¹³å°ï¼ˆéœ€è¦æ˜¾å¼æŒ‡å®šï¼‰
cargo build --package rux --features aarch64
./test/run.sh
```

### è°ƒè¯•

```bash
# RISC-V æµ‹è¯•
./test/run_riscv.sh                # å®Œæ•´è¿è¡Œ
./test/debug_riscv.sh              # GDB è°ƒè¯•
./test/all.sh riscv                # æµ‹è¯•å¥—ä»¶ï¼ˆ10ç§’è¶…æ—¶ï¼‰

# ARM64 æµ‹è¯•ï¼ˆå·²æš‚åœç»´æŠ¤ï¼‰
./test/run.sh                      # å¿«é€Ÿè¿è¡Œ
./test/debug.sh                    # GDB è°ƒè¯•
./test/test_smp.sh                 # SMP æµ‹è¯•
./test/test_ipi.sh                 # IPI æµ‹è¯•

# å…¨å¹³å°æµ‹è¯•
./test/all.sh                      # æµ‹è¯•æ‰€æœ‰å¹³å°
./test/all.sh aarch64              # ä»… ARM64
```

### å¹³å°åˆ‡æ¢

RISC-V æ˜¯é»˜è®¤å¹³å°ã€‚è¦åˆ‡æ¢åˆ° ARM å¹³å°ï¼š

```bash
# ç¼–è¾‘ kernel/Cargo.toml
# å°† default = ["riscv64"] æ”¹ä¸º default = ["aarch64"]

# æˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œæ˜¾å¼æŒ‡å®š
cargo build --package rux --features aarch64
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
Rux/
â”œâ”€â”€ kernel/                 # å†…æ ¸ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ arch/           # å¹³å°ç›¸å…³ä»£ç 
â”‚   â”‚   â”‚   â”œâ”€â”€ riscv64/    # RISC-V 64ä½æ”¯æŒï¼ˆé»˜è®¤å¹³å°ï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ boot.rs     # å¯åŠ¨æµç¨‹ï¼ˆæ ˆã€BSSã€trapï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ trap.rs     # å¼‚å¸¸å¤„ç†ï¼ˆS-modeï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ trap.S      # å¼‚å¸¸å‘é‡è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ context.rs  # ä¸Šä¸‹æ–‡åˆ‡æ¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cpu.rs      # CPU æ“ä½œ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ syscall.rs  # ç³»ç»Ÿè°ƒç”¨å¤„ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs      # æ¨¡å—å¯¼å‡º
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ linker.ld   # é“¾æ¥è„šæœ¬
â”‚   â”‚   â”‚   â””â”€â”€ aarch64/    # ARM64 æ”¯æŒ
â”‚   â”‚   â”‚       â”œâ”€â”€ boot.S     # å¯åŠ¨æ±‡ç¼– (å«æ¬¡æ ¸å…¥å£)
â”‚   â”‚   â”‚       â”œâ”€â”€ smp.rs     # SMP æ”¯æŒ (æ¬¡æ ¸å¯åŠ¨ã€Per-CPU æ•°æ®)
â”‚   â”‚   â”‚       â”œâ”€â”€ ipi.rs     # IPI (æ ¸é—´ä¸­æ–­) æ”¯æŒ
â”‚   â”‚   â”‚       â””â”€â”€ mm.rs      # å†…å­˜ç®¡ç† (MMUã€é¡µè¡¨)
â”‚   â”‚   â”œâ”€â”€ mm/             # å†…å­˜ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ allocator.rs # å †åˆ†é…å™¨ (Buddy System)
â”‚   â”‚   â”‚   â”œâ”€â”€ pagemap.rs   # é¡µè¡¨ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ vma.rs       # è™šæ‹Ÿå†…å­˜åŒºåŸŸ
â”‚   â”‚   â”œâ”€â”€ drivers/        # è®¾å¤‡é©±åŠ¨
â”‚   â”‚   â”‚   â”œâ”€â”€ intc/       # ä¸­æ–­æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ gicv3.rs # GICv3 é©±åŠ¨ (ARM)
â”‚   â”‚   â”‚   â”œâ”€â”€ timer/      # å®šæ—¶å™¨é©±åŠ¨
â”‚   â”‚   â”‚   â””â”€â”€ uart/       # UART é©±åŠ¨
â”‚   â”‚   â”œâ”€â”€ collection.rs   # è‡ªå®šä¹‰é›†åˆç±»å‹
â”‚   â”‚   â”œâ”€â”€ console.rs      # UART é©±åŠ¨
â”‚   â”‚   â”œâ”€â”€ print.rs        # æ‰“å°å®
â”‚   â”‚   â”œâ”€â”€ process/        # è¿›ç¨‹ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ sched.rs    # è°ƒåº¦å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ task.rs     # ä»»åŠ¡æ§åˆ¶å—
â”‚   â”‚   â”‚   â””â”€â”€ signal.rs   # ä¿¡å·å¤„ç†
â”‚   â”‚   â”œâ”€â”€ fs/             # æ–‡ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ vfs.rs      # VFS æ¡†æ¶
â”‚   â”‚   â”‚   â”œâ”€â”€ rootfs.rs   # RootFS å†…å­˜æ–‡ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ file.rs     # æ–‡ä»¶æŠ½è±¡
â”‚   â”‚   â”‚   â””â”€â”€ inode.rs    # Inode ç®¡ç†
â”‚   â”‚   â””â”€â”€ main.rs         # å†…æ ¸å…¥å£
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ test/                   # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ run_riscv.sh        # RISC-V è¿è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ debug_riscv.sh      # RISC-V GDB è°ƒè¯•
â”‚   â”œâ”€â”€ all.sh              # å…¨å¹³å°æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ run.sh              # ARM å¿«é€Ÿè¿è¡Œï¼ˆå·²æš‚åœï¼‰
â”‚   â”œâ”€â”€ debug.sh            # ARM GDB è°ƒè¯•ï¼ˆå·²æš‚åœï¼‰
â”‚   â”œâ”€â”€ test_smp.sh         # SMP æµ‹è¯•ï¼ˆå·²æš‚åœï¼‰
â”‚   â””â”€â”€ test_ipi.sh         # IPI æµ‹è¯•ï¼ˆå·²æš‚åœï¼‰
â”œâ”€â”€ docs/                   # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ DESIGN.md           # è®¾è®¡åŸåˆ™
â”‚   â”œâ”€â”€ TODO.md             # å¼€å‘è·¯çº¿å›¾
â”‚   â”œâ”€â”€ CODE_REVIEW.md      # ä»£ç å®¡æŸ¥è®°å½•
â”‚   â””â”€â”€ COLLECTIONS.md      # è‡ªå®šä¹‰é›†åˆç±»å‹æ–‡æ¡£
â”œâ”€â”€ build/                  # æ„å»ºå·¥å…·
â”‚   â””â”€â”€ Makefile            # æ„å»ºè„šæœ¬
â”œâ”€â”€ Makefile                # æ ¹ Makefile (å¿«æ·å‘½ä»¤)
â”œâ”€â”€ Kernel.toml             # å†…æ ¸é…ç½®æ–‡ä»¶
â”œâ”€â”€ Cargo.toml              # å·¥ä½œç©ºé—´é…ç½®
â””â”€â”€ README.md               # æœ¬æ–‡ä»¶
```

---

## ğŸ› ï¸ å¼€å‘

### æ„å»ºç³»ç»Ÿ

- **Cargo**ï¼šRust åŒ…ç®¡ç†å’Œæ„å»ºå·¥å…·
- **é“¾æ¥å™¨è„šæœ¬**ï¼š`kernel/src/linker-aarch64.ld`
- **äº¤å‰ç¼–è¯‘**ï¼šé€šè¿‡ `.cargo/config.toml` é…ç½®

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ [`docs/TODO.md`](docs/TODO.md) ä¸­æ‰¾åˆ°å¯¹åº”çš„ä»»åŠ¡
2. åˆ›å»ºç›¸åº”çš„æ¨¡å—æ–‡ä»¶
3. å®ç°åŠŸèƒ½å¹¶æ·»åŠ æµ‹è¯•
4. æ›´æ–°æ–‡æ¡£

### ä»£ç é£æ ¼

- ä½¿ç”¨ `rustfmt` æ ¼å¼åŒ–ä»£ç 
- ä½¿ç”¨ `clippy` æ£€æŸ¥ä»£ç è´¨é‡
- éµå¾ª [Rust API æŒ‡å—](https://rust-lang.github.io/api-guidelines/)

---

## ğŸ—ºï¸ è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¡†æ¶ âœ…
é¡¹ç›®åˆå§‹åŒ–ã€å¯åŠ¨ä»£ç ã€UART é©±åŠ¨ã€åŸºç¡€å†…å­˜ç®¡ç†

### Phase 2: ä¸­æ–­ä¸è¿›ç¨‹ âœ…
ä¸­æ–­å¤„ç†ã€è¿›ç¨‹è°ƒåº¦ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ã€åœ°å€ç©ºé—´ç®¡ç†

### Phase 3: ç³»ç»Ÿè°ƒç”¨ä¸éš”ç¦» âœ…
ç³»ç»Ÿè°ƒç”¨æ¥å£ã€ç”¨æˆ·/å†…æ ¸éš”ç¦»ã€ä¿¡å·å¤„ç†ã€**è‡ªå®šä¹‰é›†åˆç±»å‹**

### Phase 4: æ–‡ä»¶ç³»ç»Ÿ âœ… åŸºç¡€æ¡†æ¶å®Œæˆ
VFS æ¡†æ¶ã€æ–‡ä»¶æè¿°ç¬¦ã€åŸºæœ¬çš„æ–‡ä»¶æ“ä½œ

### Phase 5: SMP æ”¯æŒ âœ… åŸºç¡€æ¡†æ¶å®Œæˆ
å¤šæ ¸å¯åŠ¨ã€Per-CPU æ•°æ®ã€PSCI æ¥å£ã€GICv3 åˆå§‹åŒ–ã€IPI æœºåˆ¶ã€MMU å¯ç”¨

### Phase 6: ä»£ç å®¡æŸ¥ âœ… å®Œæˆ
å…¨é¢ä»£ç å®¡æŸ¥ã€è°ƒè¯•è¾“å‡ºæ¸…ç†ã€æµ‹è¯•è„šæœ¬å®Œå–„

### Phase 7: å†…å­˜ç®¡ç† âœ… å®Œæˆ
Buddy System åˆ†é…å™¨å®ç°ã€å†…å­˜é‡Šæ”¾å’Œä¼™ä¼´åˆå¹¶

### Phase 8: Per-CPU ä¼˜åŒ– âœ… åŸºç¡€å®Œæˆ
Per-CPU è¿è¡Œé˜Ÿåˆ—ã€å¯åŠ¨é¡ºåºä¼˜åŒ–ï¼ˆè´Ÿè½½å‡è¡¡å¾… Phase 9ï¼‰

### Phase 9: å¿«é€Ÿèƒœåˆ© âœ… å®Œæˆ
SimpleArc Cloneã€RootFS bug ä¿®å¤å·²å®Œæˆ

### Phase 10: RISC-V æ¶æ„ âœ… å®Œæˆ
RISC-V 64ä½æ¶æ„æ”¯æŒã€S-mode CSRã€å¼‚å¸¸å¤„ç†ã€ç³»ç»Ÿè°ƒç”¨ã€**Timer Interrupt**

### Phase 11: ç½‘ç»œä¸ IPC â³
TCP/IP åè®®æ ˆã€ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜

### Phase 12: å¤šå¹³å°æ”¯æŒ â³
x86_64 æ¶æ„æ”¯æŒï¼ˆriscv64 å·²å®Œæˆï¼‰

### Phase 13: è®¾å¤‡é©±åŠ¨ â³
PCIeã€å­˜å‚¨æ§åˆ¶å™¨ã€ç½‘ç»œè®¾å¤‡

### Phase 13: ç”¨æˆ·ç©ºé—´ â³
init è¿›ç¨‹ã€shellã€åŸºç¡€å‘½ä»¤

### Phase 14: ä¼˜åŒ–ä¸å®Œå–„ â³
æ€§èƒ½ä¼˜åŒ–ã€ç¨³å®šæ€§æå‡ã€æ–‡æ¡£å®Œå–„

è¯¦è§ [`docs/TODO.md`](docs/TODO.md)

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·æŸ¥çœ‹ [`docs/TODO.md`](docs/TODO.md) äº†è§£å½“å‰éœ€è¦å¸®åŠ©çš„ä»»åŠ¡ã€‚

### è´¡çŒ®æµç¨‹

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

---

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE)

---

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®å—åˆ°ä»¥ä¸‹é¡¹ç›®çš„å¯å‘ï¼š

- [Phil Opp's Writing an OS in Rust](https://os.phil-opp.com/)
- [Redox OS](https://gitlab.redox-os.org/redox-os/redox)
- [Theseus OS](https://github.com/theseus-os/Theseus)
- [Linux Kernel](https://www.kernel.org/)

---

## ğŸ“® è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µï¼š[GitHub](https://github.com/your-username/rux)
- é—®é¢˜åé¦ˆï¼š[Issues](https://github.com/your-username/rux/issues)

---

**æ³¨æ„**ï¼šæœ¬é¡¹ç›®ä¸»è¦ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚
